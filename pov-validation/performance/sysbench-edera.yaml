# CPU benchmark with Edera using sysbench
# Uses pre-built image to avoid package manager issues in zones
apiVersion: batch/v1
kind: Job
metadata:
  name: sysbench-edera
spec:
  template:
    spec:
      runtimeClassName: edera
      restartPolicy: Never
      containers:
      - name: sysbench
        image: severalnines/sysbench:latest
        command: ["/bin/sh", "-c"]
        args:
          - |
            echo "=== Edera CPU Benchmark (sysbench) ==="
            echo ""
            echo "System info:"
            echo "CPUs available: $(nproc)"
            cat /proc/cpuinfo | grep "model name" | head -1
            echo ""
            echo "Running CPU benchmark (10 seconds, prime numbers to 20000)..."
            echo ""
            sysbench cpu --cpu-max-prime=20000 --threads=2 --time=10 run
            echo ""
            echo "Running CPU benchmark (60 seconds for more stable results)..."
            echo ""
            sysbench cpu --cpu-max-prime=20000 --threads=2 --time=60 run
            echo ""
            echo "=== Benchmark Complete ==="
        resources:
          requests:
            memory: "512Mi"
            cpu: "2"
          limits:
            memory: "512Mi"
            cpu: "2"
